# Загальний огляд сервісу Liquidator

## Вступ

Сервіс Liquidator - це інноваційний проект, який займається відстеженням потенційних позицій для ліквідацій у протоколах ліквідності DeFi, таких як AAVE V1, AAVE V2, AAVE V3 та Compound. Основна мета проекту - ідентифікувати користувачів, які знаходяться в зоні ризику ліквідації, та заробити на цьому гроші, здійснюючи ліквідацію їхніх позицій. Цей процес також відомий як MEV (Miner Extractable Value) - можливість отримати прибуток шляхом маніпулювання порядком транзакцій у блокчейні.

## Структура сервісу Liquidator

Сервіс Liquidator складається з двох основних підсервісів:

1. **LiqRegistry**: Відповідає за збір та фільтрацію користувачів, які взаємодіяли з підтримуваними протоколами ліквідності.
2. **LiqExecutor**: Відповідає за виконання ліквідації позицій користувачів, ідентифікованих LiqRegistry.

Ця документація зосереджена на описі бізнес-логіки сервісу LiqRegistry.

## Бізнес-логіка LiqRegistry

LiqRegistry працює з протоколами ліквідності AAVE V1, AAVE V2, AAVE V3 та Compound. Основна задача сервісу - знайти користувачів, які взяли кредит у будь-якому з цих протоколів, та відслідковувати їхній Health Factor. Health Factor показує, наскільки користувач наближений до ліквідації.

Процес роботи LiqRegistry можна розділити на три основні етапи:

1. **Фільтрація блокчейну**: Сервіс профільтровує весь блокчейн, щоб знайти користувачів, які взаємодіяли з одним із чотирьох підтримуваних протоколів.
2. **Фільтрація користувачів**: Знайдені користувачі фільтруються за певними критеріями, такими як мінімальний розмір кредиту (Borrow), мінімальний розмір застави (Collateral) та Health Factor.
3. **Передача даних**: Після фільтрації інформація про користувачів, що підлягають ліквідації, передається на сервіс LiqExecutor для виконання ліквідації.

LiqRegistry - це ключовий компонент системи Liquidator, який відповідає за пошук і відстеження користувачів протоколів ліквідності, потенційно придатних для ліквідації. LiqRegistry складається з шести підсервісів, кожен з яких виконує специфічну роль у процесі фільтрації та моніторингу користувачів:

1. **Archive** - збирає всіх користувачів, які коли-небудь взаємодіяли з кожним окремим протоколом, починаючи з блоку створення протоколу. Archive також відстежує нових користувачів у реальному часі.

2. **Blacklist** - перший етап фільтрації користувачів за параметрами Health Factor, MinBorrow та MinCollateral. Він відсіює користувачів, чиї параметри занадто далекі від потенційно цікавих для ліквідації.

3. **Proxy** - допоміжний сервіс для Subgraph, який розподіляє користувачів між інстанціями Subgraph для ефективної обробки.

4. **Subgraph** - фільтрує користувачів, зосереджуючись на тих, чиї параметри Health Factor, MinBorrow та MinCollateral близькі до можливості ліквідації. Відправляє відфільтрованих користувачів на DataFetcher.

5. **DataFetcher** - приймає рішення про ліквідацію користувачів або додавання їх до WatchList для подальшого моніторингу на основі детального аналізу їх параметрів.

6. **TransmitFetcher** - моніторить транзакції Transmit у mempool для виявлення змін цін на токени, що впливають на Health Factor користувачів з WatchList, дозволяючи ліквідувати їх у тому ж блоці, де змінюється Health Factor.

Додатково, сервіс **Events** відповідає за моніторинг виходу нових блоків, відправку цих блоків по MQTT та оновлення globalReservesData.

Всі ці сервіси працюють як єдиний механізм, поступово звужуючи список користувачів на кожному етапі, щоб у кінцевому підсумку виявити тих, хто найбільш підходить для ліквідації і передати цих користувачів на наступний сервіс liqExecutor. Такий підхід дозволяє ефективно використовувати обмежені ресурси системи при роботі з великою кількістю користувачів протоколів ліквідності.

liqExecutor далі вже буде прорахувати можливість ліквідації і потенційний прибуток від ліквідації.
