# Events

Events є одним із критично важливих сервісів у структурі Liquidator, який виконує дві основні функції: моніторинг нових блоків і моніторинг GlobalReservesData.

## Функції сервісу Events

### 1. Моніторинг нових блоків:

- Сервіс Events відстежує появу нових блоків у блокчейні.
- Кожного разу, коли з'являється новий блок, сервіс відправляє MQTT повідомлення на Topic `data/block` всім іншим сервісам, які потребують цієї інформації, наприклад, сервісу Archive.
- Це дозволяє всім зацікавленим сервісам своєчасно отримувати інформацію про нові блоки і не навантажувати ETH ноду власними запитами.

### 2. Моніторинг GlobalReservesData:

- Service Events також відповідає за моніторинг і оновлення GlobalReservesData.
- GlobalReservesData містить інформацію про токени, які використовуються нашими протоколами ліквідності.
- Кожен запис у GlobalReservesData включає наступні поля:
  - Список ERC20 токенів.
  - Decimals: кількість десяткових знаків для кожного токену.
  - Price: ціна токену відносно ETH або USD (для протоколів AAVE V1 та AAVE V2 ціна вказується до ETH, для AAVE V3 та Compound - до USD).
  - Bonus: відсоток бонусу, який протокол надає за ліквідацію певних позицій по конкретних токенах.

GlobalReservesData є критично важливими для кількох сервісів, включаючи Subgraph, DataFetcher і TransmitFetcher, оскільки ці сервіси не можуть працювати без актуальної інформації про токени.

## Режими роботи Service Events

Service Events може працювати у двох режимах залежно від типу підключення до Ethereum ноди:

### 1. WebSocket:

- Підключення до Ethereum ноди через WebSockets дозволяє отримувати дані в реальному часі.
- Це знижує навантаження на ноду і забезпечує швидку передачу інформації.

### 2. HTTP:

- Підключення до Ethereum ноди через HTTP дозволяє робити постійні запити з певним інтервалом (наприклад, кожні 10 мс).
- Хоча є теорія, що HTTP-запити можуть бути швидшими, деякі експерименти показали, що це не завжди так.
- Параметри тайм-ауту можуть бути налаштовані залежно від потреб.
- GlobalReservesData надсилається окремо для кожного протоколу, наприклад `data/reserves/V1` оскільки кожен протокол має свій специфічний набір токенів. Це забезпечує точність і актуальність даних необхідних для підрахунку ціни позиції

## Приклад globalReservesData:

```json
{
  "0x6B175474E89094C44Da98b954EedeAC495271d0F": {
    "price": {
      "type": "BigNumber",
      "hex": "0x010ebb1fcaa438"
    },
    "decimals": {
      "type": "BigNumber",
      "hex": "0x12"
    },
    "bonus": {
      "type": "BigNumber",
      "hex": "0x69"
    }
  },
  "0x0000000000085d4780B73119b644AE5ecd22b376": {
    "price": {
      "type": "BigNumber",
      "hex": "0x010e2dda4f252a"
    },
    "decimals": {
      "type": "BigNumber",
      "hex": "0x12"
    },
    "bonus": {
      "type": "BigNumber",
      "hex": "0x69"
    }
  }
}
```

Примітка: перевірити чи приходять на ваш сервіс globalReservesData можна підписавшись з терміналу на один з топіків.
Наприклад:

`mqtt sub -h "10.10.100.87" -t "data/reserves/V1"`

## Висновок

Сервіс Events забезпечує надійну і своєчасну передачу критично важливої інформації, що дозволяє всій системі Liquidator працювати ефективно і безперебійно.
